{% extends "layout.html" %}
  
{% block content %}
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js">></script> <!--Carrega jQuery-->

  <h2>Data</h2>
  	<h3>Insert and Show Data</h3>

  <form action="" method="post" name="login">
  	<fieldset>
  		<legend>Insert Data:</legend>
        {{ form.hidden_tag() }}<br><br>
		    First Name:	{{ form.firstName(size=50) }}<br><br>
		    Last name: {{ form.lastName(size=50) }}<br><br>
		    Phone: {{ form.phone(size=10) }}<br><br>
		<input type="submit" value="Submit"></p>
	</fieldset>
  </form>

  {% with messages = get_flashed_messages() %}
      {% if messages %}
        <ul>
        {% for message in messages %}
            <li>{{ message }} </li>
        {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}

  <p>Show Data:</p>

  <!--Variável global com o prefixo para a pasta root da aplicação, para tornar dinâmico caso a aplicação mude de pasta-->
    <script type=text/javascript> 
      $SCRIPT_ROOT = {{ request.script_root|tojson|safe }}; 
    </script>

    <script type=text/javascript>
      $(function() {
        $('button').bind('click', function() {
          $.getJSON($SCRIPT_ROOT + '/data', function(data){ //sends a GET request to url and will send the contents of the data object as query parameters
            var dados = data.result; //var dados recebe objeto JSON do flask jsonify
            var tr=[];
            for (var i = 0; i < dados.length; i++) {
              tr.push('<tr>');
              tr.push("<td>" + dados[i].id + "</td>");
              tr.push("<td>" + dados[i].firstName + "</td>");
              tr.push("<td>" + dados[i].lastName + "</td>");
              tr.push("<td>" + dados[i].phone + "</td>");
              tr.push('</tr>');
            }
            $('table').append($(tr.join('')));
          });
          return false;
        });
      });
   </script>

<button>Get JSON data from MySQL</button>
<p>
<span id=resultado></span>
<p>
<table id="table">
    <tr>
        <th>Id</th>
        <th>Fisrt Name</th>
        <th>Last Name</th>
        <th>Phone</th>
    </tr>
    
</table>
{% endblock %}